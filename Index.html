<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buscador de Videos</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css">
    <style>
        body { background-color: #f2f2f2; }
        .container { margin-top: 50px; }
        #respuesta { overflow-y: auto; }
        .seccion-respuesta { background-color: #fff; color: #333; padding: 15px; margin-bottom: 10px; }
        h1 { color: #333; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center mb-4">Buscador de Videos</h1>

        <div class="input-group mb-3">
            <input type="text" class="form-control" id="prompt" placeholder="Prompt">
            <button class="btn btn-secondary" type="button" id="enviar">Enviar</button>
        </div>

        <div id="respuesta">
            <div class="seccion-respuesta" id="respuesta-gpt">
                <h4>Respuesta GPT:</h4>
                <p></p>
            </div>
            <div class="seccion-respuesta" id="referencias">
                <h4>Referencias:</h4>
                <p></p>
                <button id="reproducirVideo">Reproducir desde minuto X</button> 
            </div>
            <div class="seccion-respuesta" id="video">
                <h4>Video:</h4>
                <video width="320" height="240" controls>
                    <source src="" type="video/mp4"> 
                    Tu navegador no soporta la reproducción de video.
                </video>
            </div>
            <div class="seccion-respuesta" id="keywords">
                <h4>Keywords:</h4>
                <p></p>
            </div>
            <div class="seccion-respuesta" id="consumo-tokens">
                <h4>Consumo de Tokens:</h4>
                <p></p>
            </div>
        </div>
    </div>

    <script>
        const promptInput = document.getElementById('prompt');
        const enviarBtn = document.getElementById('enviar');
        const respuestaGpt = document.querySelector('#respuesta-gpt p');
        const referencias = document.querySelector('#referencias p');
        const keywords = document.querySelector('#keywords p');
        const consumoTokens = document.querySelector('#consumo-tokens p');
        const video = document.querySelector('#video video');
        const reproducirBtn = document.getElementById('reproducirVideo');

        enviarBtn.addEventListener('click', () => enviarPrompt());
        promptInput.addEventListener('keyup', (event) => {
            if (event.key === 'Enter') {
                enviarPrompt();
            }
        });

        function enviarPrompt() {
            const prompt = promptInput.value;
            fetch('http://127.0.0.1:5000/search_video', {  // Ajusta la URL y el puerto
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ prompt })
            })
            .then(response => response.json())
            .then(data => {
                respuestaGpt.textContent = data.Response.UserResponse;
                referencias.textContent = data.Response.References;
                keywords.textContent = data.Response.Keywords;
                consumoTokens.textContent = `Total: ${data.UsageTotal}, Prompt: ${data.UsagePrompt}, Completion: ${data.UsageCompletion}`;
                const videoSrc = data.Response.VideoName;
                const pathVideo = '\\\\wsl.localhost\\Ubuntu-22.04\\home\\esquezada\\Tesis\\BuscardorVideos_UNIR_TFM\\Videos\\'
                video.setAttribute('data-video-src', encodeURI(pathVideo + data.Response.SubjectName +'\\' +data.Response.VideoName));
                console.log(pathVideo + data.Response.SubjectName +'\\' +data.Response.VideoName)
                video.load(); // Recargar el video con la nueva fuente
                reproducirBtn.textContent = `Reproducir desde minuto ${data.Response.SegundoInicio}`;
            })
            .catch(error => {
                respuestaGpt.textContent = "Error al comunicarse con el servicio";
                console.error(error);
            });
        }
        reproducirBtn.addEventListener('click', () => {
            const minutoInicio = 2; // Minuto desde el que quieres iniciar (ajusta según sea necesario)
            video.currentTime = minutoInicio * 60; // Convertir minutos a segundos
            video.play();
        });
    </script>
</body>
</html>
